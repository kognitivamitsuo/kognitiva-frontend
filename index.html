<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma Kognitiva</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="chat">
        <!-- Header do chat -->
        <div id="chat-header">
            <h2>Chat de Suporte</h2>
            <button onclick="resetarChat()" id="resetButton">Resetar Chat</button>
        </div>

        <!-- Barra lateral com lista de clientes -->
        <div id="sidebar">
            <h3>Clientes</h3>
            <ul id="cliente-lista">
                <!-- Lista de clientes serÃ¡ populada dinamicamente -->
            </ul>
        </div>

        <!-- Container de mensagens do chat -->
        <div id="chat-container">
            <div id="messages">
                <!-- As mensagens serÃ£o inseridas aqui -->
            </div>
        </div>

        <!-- Input para enviar mensagens -->
        <div id="input-container">
            <input type="text" id="userInput" placeholder="Digite sua mensagem..." onkeydown="verificarEnter(event)" />
            <button onclick="enviarMensagem()">Enviar</button>
        </div>

        <!-- DiagnÃ³stico de sessÃ£o -->
        <div id="diagnostico" class="diagnostico">
            <!-- ExibiÃ§Ã£o de diagnÃ³stico com cor e texto -->
        </div>

        <!-- Ãrea de Feedback -->
        <div id="feedback-container" class="feedback-container">
            <button onclick="enviarFeedback('positivo')">ğŸ‘</button>
            <button onclick="enviarFeedback('negativo')">ğŸ‘</button>
            <textarea id="comentario-feedback" placeholder="Deixe um comentÃ¡rio..." style="display:none;"></textarea>
        </div>

        <!-- Feedback Visual -->
        <div id="feedback-status" style="display:none; padding:10px; text-align:center; font-weight:bold;"></div>
    </div>

    <script src="executarIA.js"></script>
    <script src="feedbackBox.js"></script>
    <script src="contextService.js"></script>
    <script src="diagnosticoFinal.js"></script>
    <script>
        // FunÃ§Ã£o para exibir a mensagem inicial do chat
        function renderMensagemInicial() {
            const mensagemInicial = "OlÃ¡! Como posso ajudar vocÃª hoje?";
            const chatBox = document.getElementById("chatBox"); // Elemento do chat onde as mensagens sÃ£o exibidas
            const messageElement = document.createElement("div");
            messageElement.classList.add("message", "system"); // Classe para estilizar a mensagem inicial
            messageElement.innerHTML = mensagemInicial;
            
            chatBox.appendChild(messageElement); // Adiciona a mensagem ao chat
            chatBox.scrollTop = chatBox.scrollHeight; // Rolagem automÃ¡tica para o fim do chat
        }

        // Verifica se Ã© a primeira vez que o chat foi carregado
        if (!localStorage.getItem("chatIniciado")) {
            renderMensagemInicial();
            localStorage.setItem("chatIniciado", "true"); // Marca que o chat foi iniciado
        }

        // FunÃ§Ã£o para enviar a mensagem do usuÃ¡rio e simular a IA
        function enviarMensagem() {
            const mensagem = document.getElementById("userInput").value.trim();
            if (mensagem) {
                adicionarMensagem(mensagem, 'usuario');
                document.getElementById("userInput").value = '';  // Limpar campo de entrada

                // Simular resposta da IA
                processarMensagem(mensagem);
            }
        }

        // FunÃ§Ã£o para simular a digitaÃ§Ã£o da IA
        function processarMensagem(mensagem) {
            // Exemplo de envio para IA (seria feito com backend)
            setTimeout(() => {
                const resposta = "Resposta da IA para: " + mensagem;
                adicionarMensagem(resposta, 'ia');
                mostrarDiagnostico(resposta);  // Exibe diagnÃ³stico com base na resposta
                coletarFeedback();  // Solicita feedback do usuÃ¡rio
            }, 2000);  // Simulando um delay de digitaÃ§Ã£o de IA
        }

        // FunÃ§Ã£o para adicionar a mensagem ao chat
        function adicionarMensagem(texto, tipo) {
            const messagesContainer = document.getElementById("messages");
            const mensagemElement = document.createElement("div");
            mensagemElement.classList.add(tipo);
            mensagemElement.textContent = texto;
            messagesContainer.appendChild(mensagemElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;  // Rola para a Ãºltima mensagem
        }

        // FunÃ§Ã£o para exibir o diagnÃ³stico final com base na resposta da IA
        function mostrarDiagnostico(resposta) {
            const score = calcularScore(resposta);  // Exemplo de cÃ¡lculo de score
            const diagnosticoElement = document.getElementById("diagnostico");

            if (score >= 85) {
                diagnosticoElement.textContent = "âœ… DiagnÃ³stico: Ã“TIMO";
                diagnosticoElement.style.backgroundColor = "#4CAF50"; // Verde
            } else if (score >= 60) {
                diagnosticoElement.textContent = "ğŸŸ¡ DiagnÃ³stico: REVISAR";
                diagnosticoElement.style.backgroundColor = "#FFEB3B"; // Amarelo
            } else {
                diagnosticoElement.textContent = "ğŸ”´ DiagnÃ³stico: FALHA CRÃTICA";
                diagnosticoElement.style.backgroundColor = "#F44336"; // Vermelho
            }

            diagnosticoElement.style.display = "block";
        }

        // FunÃ§Ã£o de cÃ¡lculo simples do score (pode ser aprimorado com mais lÃ³gica)
        function calcularScore(resposta) {
            if (resposta.includes("Ã³timo")) return 90;  // Exemplo: diagnÃ³stico baseado no conteÃºdo da resposta
            if (resposta.includes("revisar")) return 70;
            return 50;
        }

        // FunÃ§Ã£o para verificar pressionamento da tecla Enter
        function verificarEnter(event) {
            if (event.key === "Enter") {
                enviarMensagem();
            }
        }

        // FunÃ§Ã£o para reiniciar o chat
        function resetarChat() {
            document.getElementById("messages").innerHTML = '';
            document.getElementById("diagnostico").style.display = 'none';
            document.getElementById("feedback-container").style.display = 'none';
        }

        // FunÃ§Ã£o para coletar feedback do usuÃ¡rio
        function coletarFeedback() {
            const feedbackContainer = document.getElementById("feedback-container");
            feedbackContainer.style.display = 'block'; // Exibe Ã¡rea de feedback
            const comentarioField = document.getElementById("comentario-feedback");

            // Mostra campo de comentÃ¡rio apenas se o feedback for negativo
            document.querySelectorAll('#feedback-container button').forEach(button => {
                button.onclick = () => {
                    if (button.textContent === 'ğŸ‘') {
                        comentarioField.style.display = 'block';  // Exibe campo de comentÃ¡rio
                    } else {
                        comentarioField.style.display = 'none'; // Esconde campo de comentÃ¡rio
                    }
                };
            });
        }

        // FunÃ§Ã£o para enviar o feedback
        function enviarFeedback(tipo) {
            const comentario = document.getElementById("comentario-feedback").value.trim();
            console.log(`Feedback: ${tipo}, ComentÃ¡rio: ${comentario}`);

            // Enviar para o backend para registro
            // EnviarFeedback(tipo, comentario);
            // Resetar o campo de comentÃ¡rio
            document.getElementById("comentario-feedback").value = '';
            document.getElementById("feedback-container").style.display = 'none';  // Esconde Ã¡rea de feedback

            // Exibir feedback visual
            exibirFeedbackVisual("Feedback enviado com sucesso!", true);
        }

        // FunÃ§Ã£o para exibir feedback visual
        function exibirFeedbackVisual(mensagem, sucesso) {
            const feedbackContainer = document.getElementById("feedback-status");
            feedbackContainer.textContent = mensagem;
            feedbackContainer.style.color = sucesso ? 'green' : 'red';
            feedbackContainer.style.display = 'block';
            setTimeout(() => feedbackContainer.style.display = 'none', 3000);  // Esconde apÃ³s 3 segundos
        }
    </script>
</body>

</html>

