
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kognitiva Chat v3.6</title>
  <style>
    body {
      margin: 0;
      background-color: #1e1e2e;
      color: #fff;
      font-family: "Segoe UI", sans-serif;
    }
    #sidebar {
      width: 200px;
      background-color: #111;
      padding: 10px;
      float: left;
      height: 100vh;
    }
    #chatMessages {
      margin-left: 200px;
      padding: 10px;
      height: calc(100vh - 50px);
      overflow-y: auto;
      background-color: #2e2e3e;
    }
    .mensagem {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      max-width: 70%;
    }
    .usuario {
      background-color: #3b82f6;
      color: white;
      align-self: flex-end;
    }
    .ia {
      background-color: #f3f4f6;
      color: #111;
    }
    .sistema {
      background-color: #facc15;
      color: black;
    }
    #inputArea {
      position: fixed;
      bottom: 0;
      left: 200px;
      right: 0;
      background-color: #1e1e2e;
      padding: 10px;
      display: flex;
    }
    #inputMensagem {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
    }
    #botaoEnviar {
      margin-left: 10px;
      background-color: #22c55e;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="sidebar"><h3>Clientes</h3><ul id="listaClientes"></ul></div>
  <div id="chatMessages"></div>
  <div id="inputArea">
    <input type="text" id="inputMensagem" placeholder="Digite sua mensagem..." />
    <button id="botaoEnviar">Enviar</button>
  </div>

  <script>
// execControl.js ‚Äì respons√°vel por execu√ß√£o cognitiva com fallback e rastreabilidade

async function executarIA(payload, tokenSessao) {
  try {
    const resposta = await fetch("https://sync.kognitiva.app/executar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${tokenSessao}`
      },
      body: JSON.stringify(payload)
    });

    const dados = await resposta.json();
    return {
      resposta: dados.resposta,
      modelo_utilizado: dados.modelo_utilizado,
      superprompt: dados.superprompt,
      score_resposta: dados.score_resposta,
      fallback_ativado: dados.fallback_ativado || false
    };
  } catch (erro) {
    console.error("Erro na execu√ß√£o da IA:", erro);
    return {
      resposta: "‚ö† Erro na IA. Modo alternativo ativado.",
      modelo_utilizado: "fallback",
      superprompt: null,
      score_resposta: 0,
      fallback_ativado: true
    };
  }
}
</script>
  <script>
// contextService.js ‚Äì respons√°vel por salvar e recuperar contexto com fallback

async function salvarContexto(token, cliente, contexto) {
  try {
    await fetch("https://sync.kognitiva.app/proxy/contexto", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify(payload),
        cliente_nome: cliente,
        contexto: contexto
      })
    });
  } catch (erro) {
    console.error("Erro ao salvar contexto:", erro);
  }
}

async function obterContexto(token, cliente) {
  try {
    const resposta = await fetch("https://sync.kognitiva.app/proxy/contexto?cliente_nome=" + encodeURIComponent(cliente), {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`
      }
    });

    const dados = await resposta.json();
    return dados.contexto || "";
  } catch (erro) {
    console.error("Erro ao obter contexto:", erro);
    return "";
  }
}
</script>
  <script>
// feedbackBox.js ‚Äì Bot√µes de avalia√ß√£o + campo para feedback textual

function configurarFeedback(tokenSessao, clienteAtual) {
  const positivo = document.getElementById("btnFeedbackUp");
  const negativo = document.getElementById("btnFeedbackDown");

  positivo.addEventListener("click", () => enviarFeedback(10, ""));
  negativo.addEventListener("click", () => {
    const comentario = prompt("O que podemos melhorar?");
    enviarFeedback(4, comentario || "");
  });

  async function enviarFeedback(score, comentario) {
    try {
      const resposta = await fetch("https://sync.kognitiva.app/proxy/feedback", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${tokenSessao}`
        },
        body: JSON.stringify(payload),
          cliente_nome: clienteAtual,
          score_resposta: score,
          mensagem_feedback: comentario
        })
      });

      const dados = await resposta.json();
      adicionarMensagem("sistema", "‚úÖ Feedback enviado com sucesso!");
    } catch (erro) {
      console.error("Erro ao enviar feedback:", erro);
      adicionarMensagem("sistema", "‚ö† Falha ao enviar feedback.");
    }
  }
}
</script>
  <script>
// diagnosticoFinal.js ‚Äì Exibe avalia√ß√£o da resposta da IA no final da conversa

function exibirDiagnosticoFinal(score, modelo) {
  let classificacao = "";
  if (score >= 85) {
    classificacao = "‚úÖ √ìTIMO ‚Äì resposta acima da m√©dia";
  } else if (score >= 60) {
    classificacao = "üü° REVISAR ‚Äì resposta aceit√°vel, mas com margem de erro";
  } else {
    classificacao = "üî¥ FALHA CR√çTICA ‚Äì resposta inadequada ou incoerente";
  }

  const mensagem = `üìä Diagn√≥stico final:
Modelo: ${modelo}
Score: ${score}
Classifica√ß√£o: ${classificacao}`;

  adicionarMensagem("sistema", mensagem);
}
</script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("inputMensagem");
  const botao = document.getElementById("botaoEnviar");
  const chat = document.getElementById("chatMessages");
  const listaClientes = document.getElementById("listaClientes");

  let tokenSessao = null;
  let clienteAtual = null;
  let clientes = [];

  async function obterToken() {
    const payload = {
      usuario_id: "visitante_anonimo",
      cliente_nome: "visitante",
      segmento: "geral",
      canal_comunicacao: "chat",
      produto: "default"
    };
    try {
      const resposta = await fetch("https://sync.kognitiva.app/proxy/token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
      });
      const dados = await resposta.json();
      tokenSessao = dados.token;
    } catch (erro) {
      console.error("Erro ao obter token:", erro);
    }
  }

  async function iniciarSessaoComCliente(nomeCliente) {
    clienteAtual = nomeCliente;
    if (!clientes.includes(nomeCliente)) {
      clientes.push(nomeCliente);
      clientes.sort();
      atualizarListaClientes();
    }
    adicionarMensagem("sistema", `Sess√£o iniciada com ${nomeCliente}`);
  }

  function atualizarListaClientes() {
    listaClientes.innerHTML = "";
    clientes.forEach((nome) => {
      const item = document.createElement("div");
      item.className = "clienteItem";
      item.textContent = nome;
      item.onclick = () => iniciarSessaoComCliente(nome);
      listaClientes.appendChild(item);
    });
  }

  function adicionarMensagem(tipo, texto) {
    const msg = document.createElement("div");
    msg.className = `mensagem ${tipo}`;
    msg.textContent = texto;
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;
  }

  async function enviarMensagem() {
    const texto = input.value.trim();
    if (!texto || !clienteAtual) return;

    adicionarMensagem("usuario", texto);
    input.value = "";

    const contexto = await obterContexto(tokenSessao, clienteAtual);
    const payload = {
      mensagem_usuario: texto,
      cliente_nome: clienteAtual,
      contexto_cliente: contexto
    };

    try {
      const resposta = await fetch("https://sync.kognitiva.app/executar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${tokenSessao}`
        },
        body: JSON.stringify(payload)
      });
      const dados = await resposta.json();
      adicionarMensagem("ia", dados.resposta);
      salvarContexto(tokenSessao, clienteAtual, dados.superprompt);
      exibirDiagnosticoFinal(dados.score_resposta, dados.modelo_utilizado);
    } catch (erro) {
      console.error("Erro ao enviar mensagem:", erro);
      adicionarMensagem("sistema", "‚ö† Erro na IA. Modo alternativo ativado.");
    }
  }

  botao.addEventListener("click", enviarMensagem);
  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") enviarMensagem();
  });

  input.addEventListener("blur", () => {
    const texto = input.value.trim();
    if (texto.toLowerCase().startsWith("quero come√ßar com cliente ")) {
      const nome = texto.split("cliente ")[1];
      if (nome) {
        iniciarSessaoComCliente(nome);
        input.value = "";
      }
    }
  });

  obterToken();
});
</script>
</body>
</html>

</script>
</body>
</html>
